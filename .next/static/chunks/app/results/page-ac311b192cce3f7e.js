(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[87],{9713:function(e,t,n){Promise.resolve().then(n.bind(n,9863))},9376:function(e,t,n){"use strict";var r=n(5475);n.o(r,"useRouter")&&n.d(t,{useRouter:function(){return r.useRouter}}),n.o(r,"useSearchParams")&&n.d(t,{useSearchParams:function(){return r.useSearchParams}})},9863:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return i}});var r=n(7437),a=n(2265),s=n(9376);function o(){let[e,t]=(0,a.useState)([]),[n,o]=(0,a.useState)(-1),[i,l]=(0,a.useState)(!0),[c,d]=(0,a.useState)(!1),[m,f]=(0,a.useState)(null),[u,h]=(0,a.useState)(!0),[p,g]=(0,a.useState)(!1),[x,b]=(0,a.useState)(!1),[v,y]=(0,a.useState)(!1),[S,j]=(0,a.useState)(null),N=(0,s.useRouter)(),I=(0,s.useSearchParams)(),w=(0,a.useRef)(-1);(0,a.useEffect)(()=>{let e=I.get("mode"),t=I.get("roomId");"online"===e&&t?(b(!0),j(t),y("true"===localStorage.getItem("host_".concat(t))),k(t)):M()},[I]),(0,a.useEffect)(()=>{if(x&&S){let e=setInterval(()=>{O(S)},2e3);return()=>clearInterval(e)}},[x,S]);let k=async e=>{try{let n=await fetch("/api/rooms",{method:"POST",body:JSON.stringify({action:"status",roomId:e})}),r=await n.json();if(r.error){N.push("/");return}t(r.results),h(r.isRandomMode),g(r.isOttMode),l(!1),D(r.revealIndex,r.results,r.isRandomMode)}catch(e){console.error(e)}},O=async e=>{try{let t=await fetch("/api/rooms",{method:"POST",body:JSON.stringify({action:"status",roomId:e})}),n=await t.json();n.revealIndex!==w.current&&D(n.revealIndex,n.results,n.isRandomMode)}catch(e){console.error(e)}},D=(e,t,n)=>{if(e===w.current||(w.current,w.current=e,e<0||!t[e]))return;if(!n){o(e);return}o(e),d(!0);let r=0,a=setInterval(()=>{let n=t?t.length:0;if(f(n>0?Math.floor(Math.random()*n)+1:1),++r>12){var s;clearInterval(a),f((null===(s=t[e])||void 0===s?void 0:s.giftNumber)||1),d(!1)}},60)},M=()=>{let e=localStorage.getItem("secretSantaParticipants"),t="true"===localStorage.getItem("secretSantaRandomMode");h(t);let n=localStorage.getItem("secretSantaOttMode");if(g("true"===n),!e){N.push("/");return}let r=JSON.parse(e);if(r.length<2){N.push("/");return}C(r,t,"true"===n)},C=(e,n,r)=>{let a=[...e],s=!1,o=[],i=0;for(;!s&&i<500;){i++;for(let e=a.length-1;e>0;e--){let t=Math.floor(Math.random()*(e+1));[a[e],a[t]]=[a[t],a[e]]}let t=e.map(e=>e.giftIndex);if(r)for(let e=t.length-1;e>0;e--){let n=Math.floor(Math.random()*(e+1));[t[e],t[n]]=[t[n],t[e]]}s=!0,o=[];for(let i=0;i<e.length;i++){if(n&&(r?t[i]:e[i].giftIndex)===a[i].giftIndex||e[i].name===a[i].name){s=!1;break}let l=r?t[i]:e[i].giftIndex;o.push({giver:e[i].name,receiver:a[i].name,giftNumber:n?l:null,giftOwner:e.find(e=>e.giftIndex===l).name})}}for(let e=o.length-1;e>0;e--){let t=Math.floor(Math.random()*(e+1));[o[e],o[t]]=[o[t],o[e]]}t(o),localStorage.setItem("secretSantaFinalPairs",JSON.stringify(o)),l(!1),D(0,o,n)},P=async()=>{if(n<((null==e?void 0:e.length)||0)-1&&!c){if(x){d(!0);try{await fetch("/api/rooms",{method:"POST",body:JSON.stringify({action:"revealNext",roomId:S})})}catch(e){console.error(e),d(!1)}}else D(n+1,e,u)}},R=async()=>{if(x&&S){try{let e=localStorage.getItem("participant_".concat(S)),t=e?JSON.parse(e):null;await fetch("/api/rooms",{method:"POST",body:JSON.stringify({action:"leave",roomId:S,participantId:null==t?void 0:t.id,isHost:v})})}catch(e){console.error("Failed to leave room",e)}N.push("/online")}else N.push("/offline")},_=e&&n===e.length-1;return i?(0,r.jsxs)("main",{children:[(0,r.jsx)("div",{className:"snow-container"}),(0,r.jsx)("div",{style:{textAlign:"center",padding:"40px"},children:(0,r.jsx)("h2",{className:"pulse",children:"Preparing the gifts... \uD83C\uDF81✨"})})]}):(0,r.jsxs)("main",{children:[(0,r.jsx)("div",{className:"snow-container"}),(0,r.jsx)("h1",{children:"Secret Santa Reveal \uD83C\uDF85"}),(0,r.jsxs)("div",{className:"reveal-container",children:[n>=0&&e[n]&&(0,r.jsxs)("div",{className:"pair-card ".concat(c?"shuffling-gift":"fade-in"),children:[u&&(0,r.jsxs)("div",{className:"gift-number ".concat(c?"animating":""),children:["Gift #",m]}),(0,r.jsxs)("div",{className:"names",children:[(0,r.jsxs)("div",{className:"person",children:[(0,r.jsx)("span",{className:"label",children:"Gifter"}),(0,r.jsx)("strong",{className:"name",children:e[n].giver})]}),(0,r.jsx)("div",{className:"arrow",children:"➔"}),(0,r.jsxs)("div",{className:"person",children:[(0,r.jsx)("span",{className:"label",children:"Receiver"}),(0,r.jsx)("strong",{className:"name",children:e[n].receiver})]})]})]}),(0,r.jsx)("div",{className:"controls",children:_?(0,r.jsxs)("div",{className:"end-message",children:[(0,r.jsx)("p",{children:"All gifts have been assigned! \uD83C\uDF85"}),(0,r.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"1rem",alignItems:"center"},children:[(0,r.jsx)("button",{className:"next-btn",onClick:()=>N.push("/summary".concat(x?"?mode=online&roomId=".concat(S):"")),children:"View Final List \uD83D\uDCCB"}),(0,r.jsx)("button",{className:"back-btn",onClick:()=>N.push("/"),children:"⬅️ Start Over"})]})]}):(0,r.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"1rem",alignItems:"center"},children:[!x||v?(0,r.jsx)("button",{className:"next-btn",onClick:P,disabled:c,children:c?"Choosing... \uD83C\uDFB2":"Next Pair \uD83C\uDF81"}):(0,r.jsx)("p",{style:{fontStyle:"italic",opacity:.8},children:"Waiting for host to reveal next pair..."}),(0,r.jsx)("button",{className:"reset-btn",onClick:R,children:x?"Leave Room ⬅️":"Reset & Go Back ⬅️"})]})})]}),(0,r.jsx)("style",{dangerouslySetInnerHTML:{__html:"\n        .reveal-container { display: flex; flex-direction: column; align-items: center; gap: 2rem; margin-top: 2rem; }\n        .pair-card { background: rgba(255, 255, 255, 0.1); padding: 2.5rem; border-radius: 20px; border: 2px solid #ffd700; box-shadow: 0 0 20px rgba(255, 215, 0, 0.3); text-align: center; width: 100%; box-sizing: border-box; }\n        .gift-number { font-size: 1.5rem; color: #ffd700; margin-bottom: 1.5rem; font-weight: bold; text-transform: uppercase; }\n        .names { display: flex; justify-content: space-around; align-items: center; gap: 1rem; }\n        .person { display: flex; flex-direction: column; word-break: break-word; max-width: 100%; }\n        .label { font-size: 0.8rem; text-transform: uppercase; opacity: 0.8; margin-bottom: 0.5rem; }\n        .name { font-size: 1.8rem; color: #fff; }\n        .arrow { font-size: 2rem; color: #ff4d4d; }\n        .next-btn { background: #ff4d4d; color: white; border: none; padding: 1rem 2.5rem; border-radius: 50px; font-size: 1.2rem; cursor: pointer; transition: transform 0.2s; box-shadow: 0 4px 15px rgba(255, 77, 77, 0.4); }\n        .next-btn:hover:not(:disabled) { transform: scale(1.05); }\n        .next-btn:disabled { background: #ccc; cursor: not-allowed; }\n        .reset-btn { background: transparent; color: #f8e3a1; border: 1px solid #f8e3a1; padding: 0.5rem 1.5rem; border-radius: 50px; font-size: 0.9rem; cursor: pointer; margin-top: 0.5rem; }\n        .pulse { animation: pulse 1.5s infinite; }\n        @keyframes pulse { 0% { opacity: 0.5; } 50% { opacity: 1; } 100% { opacity: 0.5; } }\n        .shuffling-gift { border-color: #ffd700; box-shadow: 0 0 30px rgba(255, 215, 0, 0.5); }\n        .gift-number.animating { animation: shake 0.1s infinite; color: #ff4d4d; }\n        @keyframes shake {\n          0% { transform: translate(1px, 1px) rotate(0deg); }\n          25% { transform: translate(-1px, -1px) rotate(-1deg); }\n          50% { transform: translate(-1px, 1px) rotate(1deg); }\n          75% { transform: translate(1px, -1px) rotate(0deg); }\n          100% { transform: translate(1px, 1px) rotate(1deg); }\n        }\n        .fade-in { animation: fadeIn 0.5s ease-out forwards; }\n        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }\n        @media (max-width: 600px) {\n          .names { flex-direction: column; gap: 1.5rem; }\n          .arrow { transform: rotate(90deg); }\n          .name { font-size: 1.5rem; }\n        }\n      "}})]})}function i(){return(0,r.jsx)(a.Suspense,{fallback:(0,r.jsx)("div",{children:"Loading..."}),children:(0,r.jsx)(o,{})})}}},function(e){e.O(0,[971,117,744],function(){return e(e.s=9713)}),_N_E=e.O()}]);