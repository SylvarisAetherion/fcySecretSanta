(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[666],{707:function(e,t,n){Promise.resolve().then(n.bind(n,2998))},9376:function(e,t,n){"use strict";var s=n(5475);n.o(s,"useRouter")&&n.d(t,{useRouter:function(){return s.useRouter}}),n.o(s,"useSearchParams")&&n.d(t,{useSearchParams:function(){return s.useSearchParams}})},2998:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return r}});var s=n(7437),a=n(2265),i=n(9376);function r(){let[e,t]=(0,a.useState)([]),[n,r]=(0,a.useState)(null),[o,l]=(0,a.useState)(null),[c,d]=(0,a.useState)(!1),[p,h]=(0,a.useState)(!0),[m,u]=(0,a.useState)(""),[x,f]=(0,a.useState)(""),[g,j]=(0,a.useState)(!0),[y,b]=(0,a.useState)(!0),[S,v]=(0,a.useState)(!1),[N,w]=(0,a.useState)(!1),k=(0,i.useRouter)();(0,a.useEffect)(()=>{I();let e=setInterval(I,5e3);return()=>clearInterval(e)},[]),(0,a.useEffect)(()=>{if(n&&!n.isStarted){let e=setInterval(async()=>{let e=await fetch("/api/rooms",{method:"POST",body:JSON.stringify({action:"status",roomId:n.id})}),t=await e.json();t.isStarted?k.push("/results?mode=online&roomId=".concat(n.id)):r(t)},3e3);return()=>clearInterval(e)}},[n,k]);let I=async()=>{try{let e=await fetch("/api/rooms"),n=await e.json();t(n)}catch(e){console.error("Failed to fetch rooms",e)}finally{h(!1)}},C=async e=>{if(e.preventDefault(),!x){alert("Please enter your name first!");return}let t=await fetch("/api/rooms",{method:"POST",body:JSON.stringify({action:"create",roomName:m||"".concat(x,"'s Room"),isRandomMode:y,isOttMode:S})}),n=await t.json();r(n),d(!0),localStorage.setItem("host_".concat(n.id),"true"),g&&await O(n.id,x)},O=async(e,t)=>{let n=await fetch("/api/rooms",{method:"POST",body:JSON.stringify({action:"join",roomId:e,participantName:t||x})}),s=await n.json();if(s.error){alert(s.error);return}r(s.room),l(s.participant),localStorage.setItem("participant_".concat(e),JSON.stringify(s.participant))},R=async()=>{if(!(null==n?void 0:n.participants)||n.participants.length<2){alert("Need at least 2 participants");return}w(!0);try{let e=await fetch("/api/rooms",{method:"POST",body:JSON.stringify({action:"start",roomId:n.id})}),t=await e.json();t.error?(alert(t.error),w(!1)):k.push("/results?mode=online&roomId=".concat(n.id))}catch(e){console.error(e),alert("Failed to start game"),w(!1)}},P=async()=>{if(n)try{await fetch("/api/rooms",{method:"POST",body:JSON.stringify({action:"leave",roomId:n.id,participantId:null==o?void 0:o.id,isHost:c})})}catch(e){console.error("Failed to leave room",e)}r(null),l(null),d(!1)};if(p)return(0,s.jsxs)("main",{children:[(0,s.jsx)("div",{className:"snow-container"}),(0,s.jsx)("h1",{children:"Loading Rooms... ❄️"})]});if(n){var _,T;return(0,s.jsxs)("main",{children:[(0,s.jsx)("div",{className:"snow-container"}),(0,s.jsxs)("h1",{children:["\uD83C\uDF84 Room: ",n.name]}),(0,s.jsxs)("div",{className:"room-info",style:{textAlign:"center",marginBottom:"20px"},children:[(0,s.jsxs)("p",{children:["Room ID: ",(0,s.jsx)("strong",{children:n.id})]}),(0,s.jsx)("p",{children:"Share this ID with your friends!"})]}),(0,s.jsxs)("div",{className:"participants-list",children:[(0,s.jsxs)("h3",{children:["Participants (",(null===(_=n.participants)||void 0===_?void 0:_.length)||0,")"]}),(0,s.jsx)("ul",{children:null===(T=n.participants)||void 0===T?void 0:T.map((e,t)=>(0,s.jsxs)("li",{children:[(0,s.jsx)("span",{children:e.name}),(0,s.jsxs)("span",{className:"gift-tag",children:["Gift #",e.giftIndex]})]},e.id))})]}),c?(0,s.jsx)("div",{className:"controls",style:{marginTop:"20px"},children:(0,s.jsx)("button",{className:"start-btn",onClick:R,disabled:N,children:N?"Starting... ✨":"Start Game ✨"})}):(0,s.jsx)("p",{style:{textAlign:"center",fontStyle:"italic",opacity:.8},children:"Waiting for the host to start the game..."}),(0,s.jsx)("button",{className:"back-btn",onClick:P,children:"Leave Room"}),(0,s.jsx)("style",{dangerouslySetInnerHTML:{__html:"\n          .gift-tag {\n            font-size: 0.8rem;\n            color: #ffd700;\n            background: rgba(255,215,0,0.1);\n            padding: 2px 8px;\n            border-radius: 10px;\n          }\n          li {\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n          }\n        "}})]})}return(0,s.jsxs)("main",{children:[(0,s.jsx)("div",{className:"snow-container"}),(0,s.jsx)("h1",{children:"\uD83C\uDF10 Online Secret Santa"}),(0,s.jsxs)("div",{className:"online-container fade-in",children:[(0,s.jsxs)("div",{className:"global-name-input",style:{marginBottom:"2rem"},children:[(0,s.jsx)("h3",{children:"Enter your name to join or create a room:"}),(0,s.jsx)("input",{type:"text",placeholder:"Your Name",value:x,onChange:e=>f(e.target.value)})]}),e.length>0?(0,s.jsxs)("div",{className:"rooms-section",children:[(0,s.jsx)("h3",{children:"Active Rooms"}),(0,s.jsx)("div",{className:"room-grid",children:e.map(e=>(0,s.jsxs)("div",{className:"room-card",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("strong",{children:e.name}),(0,s.jsxs)("p",{children:[e.participantCount," participants • ",e.isStarted?"Started":"Waiting"]})]}),!e.isStarted&&(0,s.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[(0,s.jsx)("span",{style:{fontSize:"0.8rem",opacity:.8},children:"Join"}),(0,s.jsxs)("label",{className:"switch",style:{transform:"scale(0.8)"},children:[(0,s.jsx)("input",{type:"checkbox",onChange:t=>{if(t.target.checked){if(!x){alert("Please enter your name first!"),t.target.checked=!1;return}O(e.id,x)}}}),(0,s.jsx)("span",{className:"slider round"})]})]})]},e.id))})]}):(0,s.jsx)("div",{className:"no-rooms",children:(0,s.jsx)("p",{children:"No active rooms found. Be the first to create one!"})}),(0,s.jsx)("hr",{style:{margin:"2rem 0",opacity:.2}}),(0,s.jsxs)("form",{className:"create-room-form",onSubmit:C,children:[(0,s.jsx)("h3",{children:"Create a New Room"}),(0,s.jsx)("input",{type:"text",placeholder:"Room Name (Optional)",value:m,onChange:e=>u(e.target.value)}),(0,s.jsxs)("div",{className:"mode-selection",style:{margin:"15px 0",display:"flex",flexDirection:"column",gap:"15px"},children:[(0,s.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"10px"},children:[(0,s.jsx)("span",{children:"Host Only"}),(0,s.jsxs)("label",{className:"switch",children:[(0,s.jsx)("input",{type:"checkbox",checked:g,onChange:e=>j(e.target.checked),id:"host-role"}),(0,s.jsx)("span",{className:"slider round"})]}),(0,s.jsx)("span",{children:"I am also a participant"})]}),(0,s.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"10px"},children:[(0,s.jsx)("span",{children:"Standard"}),(0,s.jsxs)("label",{className:"switch",children:[(0,s.jsx)("input",{type:"checkbox",checked:y,onChange:e=>b(e.target.checked)}),(0,s.jsx)("span",{className:"slider round"})]}),(0,s.jsx)("span",{children:"Randomize Gift"})]}),(0,s.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"10px"},children:[(0,s.jsx)("span",{children:"Single"}),(0,s.jsxs)("label",{className:"switch",children:[(0,s.jsx)("input",{type:"checkbox",checked:S,onChange:e=>v(e.target.checked)}),(0,s.jsx)("span",{className:"slider round"})]}),(0,s.jsx)("span",{children:"OTT Mode"})]})]}),(0,s.jsx)("button",{type:"submit",className:"start-btn",children:"Create & Join Room \uD83C\uDF85"})]})]}),(0,s.jsx)("button",{className:"back-btn",onClick:()=>k.push("/"),children:"⬅️ Back to Home"}),(0,s.jsx)("style",{dangerouslySetInnerHTML:{__html:'\n        .room-grid {\n          display: flex;\n          flex-direction: column;\n          gap: 10px;\n        }\n        .room-card {\n          background: rgba(255,255,255,0.1);\n          padding: 15px;\n          border-radius: 12px;\n          border: 1px solid rgba(255,215,0,0.3);\n          display: flex;\n          justify-content: space-between;\n          align-items: center;\n        }\n        .room-card p {\n          margin: 0;\n          font-size: 0.8rem;\n          opacity: 0.7;\n        }\n        .create-room-form {\n          display: flex;\n          flex-direction: column;\n          gap: 10px;\n        }\n        .create-room-form input[type="text"] {\n          width: 100%;\n          box-sizing: border-box;\n        }\n        /* Toggle Switch Styles (copied for consistency) */\n        .switch {\n          position: relative;\n          display: inline-block;\n          width: 50px;\n          height: 24px;\n        }\n        .switch input {\n          opacity: 0; width: 0; height: 0;\n        }\n        .slider {\n          position: absolute; cursor: pointer;\n          top: 0; left: 0; right: 0; bottom: 0;\n          background-color: rgba(255,255,255,0.1);\n          transition: .4s; border: 1px solid #ffd700;\n        }\n        .slider:before {\n          position: absolute; content: "";\n          height: 16px; width: 16px; left: 3px; bottom: 3px;\n          background-color: #ffd700; transition: .4s;\n        }\n        input:checked + .slider { background-color: #1a472a; }\n        input:checked + .slider:before { transform: translateX(26px); }\n        .slider.round { border-radius: 24px; }\n        .slider.round:before { border-radius: 50%; }\n      '}})]})}}},function(e){e.O(0,[971,117,744],function(){return e(e.s=707)}),_N_E=e.O()}]);